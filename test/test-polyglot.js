!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";function isThenable(e,t){return Typeson$1.isObject(e)&&"function"==typeof e.then&&(!t||"function"==typeof e.catch)}function toStringTag(e){return o.call(e).slice(8,-1)}function hasConstructorOf(t,n){if(!t||"object"!==(void 0===t?"undefined":e(t)))return!1;var r=a(t);if(!r)return!1;var i=s.call(r,"constructor")&&r.constructor;return"function"!=typeof i?null===n:"function"==typeof i&&null!==n&&c.call(i)===c.call(n)}function isPlainObject(e){if(!e||"Object"!==toStringTag(e))return!1;return!a(e)||hasConstructorOf(e,Object)}function isUserObject(e){if(!e||"Object"!==toStringTag(e))return!1;var t=a(e);return!t||(hasConstructorOf(e,Object)||isUserObject(t))}function isObject(t){return t&&"object"===(void 0===t?"undefined":e(t))}function Typeson$1(o){var a=[],s=[],c={},A=this.types={},u=this.stringify=function(e,t,n,r){r=Object.assign({},o,r,{stringification:!0});var a=p(e,null,r);return i(a)?JSON.stringify(a[0],t,n):a.then(function(e){return JSON.stringify(e,t,n)})};this.stringifySync=function(e,t,n,r){return u(e,t,n,Object.assign({},{throwOnBadSyncType:!0},r,{sync:!0}))},this.stringifyAsync=function(e,t,n,r){return u(e,t,n,Object.assign({},{throwOnBadSyncType:!0},r,{sync:!1}))};var l=this.parse=function(e,t,n){return n=Object.assign({},o,n,{parse:!0}),f(JSON.parse(e,t),n)};this.parseSync=function(e,t,n){return l(e,t,Object.assign({},{throwOnBadSyncType:!0},n,{sync:!0}))},this.parseAsync=function(e,t,n){return l(e,t,Object.assign({},{throwOnBadSyncType:!0},n,{sync:!1}))},this.specialTypeNames=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.returnTypeNames=!0,this.encapsulate(e,t,n)},this.rootTypeName=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.iterateNone=!0,this.encapsulate(e,t,n)};var p=this.encapsulate=function(A,u,l){function finish(e){var t=Object.values(f);if(l.iterateNone)return t.length?t[0]:Typeson$1.getJSONType(e);if(t.length){if(l.returnTypeNames)return[].concat(n(new Set(t)));e&&isPlainObject(e)&&!e.hasOwnProperty("$types")?e.$types=f:e={$:e,$types:{$:f}}}else isObject(e)&&e.hasOwnProperty("$types")&&(e={$:e,$types:!0});return!l.returnTypeNames&&e}function checkPromises(e,n){return Promise.all(n.map(function(e){return e[1].p})).then(function(r){return Promise.all(r.map(function(r){var i=[],o=n.splice(0,1)[0],a=t(o,7),s=a[0],c=a[2],A=a[3],u=a[4],l=a[5],p=a[6],f=_encapsulate(s,r,c,A,i,!0,p),g=hasConstructorOf(f,TypesonPromise);return s&&g?f.p.then(function(t){return u[l]=t,checkPromises(e,i)}):(s?u[l]=f:e=g?f.p:f,checkPromises(e,i))}))}).then(function(){return e})}function _encapsulate(t,n,o,s,c,A,u){var p=void 0,d={},w=void 0===n?"undefined":e(n),b=v?function(e){var r=u||s.type||Typeson$1.getJSONType(n);v(Object.assign(e||d,{keypath:t,value:n,cyclic:o,stateObj:s,promisesData:c,resolvingTypesonPromise:A,awaitingTypesonPromise:hasConstructorOf(n,TypesonPromise)},void 0!==r?{type:r}:{}))}:null;if(w in{string:1,boolean:1,number:1,undefined:1})return void 0===n||"number"===w&&(isNaN(n)||n===-1/0||n===1/0)?(p=replace(t,n,s,c,!1,A,b))!==n&&(d={replaced:p}):p=n,b&&b(),p;if(null===n)return b&&b(),n;if(o&&!s.iterateIn&&!s.iterateUnsetNumeric){var m=g.indexOf(n);if(!(m<0))return f[t]="#",b&&b({cyclicKeypath:y[m]}),"#"+y[m];!0===o&&(g.push(n),y.push(t))}var h=isPlainObject(n),I=i(n),C=(h||I)&&(!a.length||s.replaced)||s.iterateIn?n:replace(t,n,s,c,h||I,null,b),D=void 0;if(C!==n?(p=C,d={replaced:C}):I||"array"===s.iterateIn?(D=new Array(n.length),d={clone:D}):h||"object"===s.iterateIn?d={clone:D={}}:""===t&&hasConstructorOf(n,TypesonPromise)?(c.push([t,n,o,s,void 0,void 0,s.type]),p=n):p=n,b&&b(),l.iterateNone)return D||p;if(!D)return p;if(s.iterateIn){for(var M in n){var x={ownKeys:n.hasOwnProperty(M)},B=t+(t?".":"")+escapeKeyPathComponent(M),E=_encapsulate(B,n[M],!!o,x,c,A);hasConstructorOf(E,TypesonPromise)?c.push([B,E,!!o,x,D,M,x.type]):void 0!==E&&(D[M]=E)}b&&b({endIterateIn:!0,end:!0})}else r(n).forEach(function(e){var r=t+(t?".":"")+escapeKeyPathComponent(e),i={ownKeys:!0},a=_encapsulate(r,n[e],!!o,i,c,A);hasConstructorOf(a,TypesonPromise)?c.push([r,a,!!o,i,D,e,i.type]):void 0!==a&&(D[e]=a)}),b&&b({endIterateOwn:!0,end:!0});if(s.iterateUnsetNumeric){for(var O=n.length,T=0;T<O;T++)if(!(T in n)){var S=t+(t?".":"")+T,Q={ownKeys:!1},q=_encapsulate(S,void 0,!!o,Q,c,A);hasConstructorOf(q,TypesonPromise)?c.push([S,q,!!o,Q,D,T,Q.type]):void 0!==q&&(D[T]=q)}b&&b({endIterateUnsetNumeric:!0,end:!0})}return D}function replace(e,t,n,r,i,o,A){for(var u=i?a:s,l=u.length;l--;){var g=u[l];if(g.test(t,n)){var y=g.type;if(c[y]){var d=f[e];f[e]=d?[y].concat(d):y}if(n=Object.assign(n,{type:y,replaced:!0}),(p||!g.replaceAsync)&&!g.replace)return A&&A({typeDetected:!0}),_encapsulate(e,t,w&&"readonly",n,r,o,y);A&&A({replacing:!0});return _encapsulate(e,g[p||!g.replaceAsync?"replace":"replaceAsync"](t,n),w&&"readonly",n,r,o,y)}}return t}var p=(l=Object.assign({sync:!0},o,l)).sync,f={},g=[],y=[],d=[],w=!(l&&"cyclic"in l)||l.cyclic,v=l.encapsulateObserver,b=_encapsulate("",A,w,u||{},d);return d.length?p&&l.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():Promise.resolve(checkPromises(b,d)).then(finish):!p&&l.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():l.stringification&&p?[finish(b)]:p?finish(b):Promise.resolve(finish(b))};this.encapsulateSync=function(e,t,n){return p(e,t,Object.assign({},{throwOnBadSyncType:!0},n,{sync:!0}))},this.encapsulateAsync=function(e,t,n){return p(e,t,Object.assign({},{throwOnBadSyncType:!0},n,{sync:!1}))};var f=this.revive=function(e,n){function _revive(e,n,o,a,l,p){if(!A||"$types"!==e){var f=s[e];if(i(n)||isPlainObject(n)){var g=i(n)?new Array(n.length):{};for(r(n).forEach(function(t){var r=_revive(e+(e?".":"")+escapeKeyPathComponent(t),n[t],o||g,a,g,t);hasConstructorOf(r,Undefined$1)?g[t]=void 0:void 0!==r&&(g[t]=r)}),n=g;u.length;){var y=t(u[0],4),d=y[0],w=y[1],v=y[2],b=y[3],m=getByKeyPath(d,w);if(hasConstructorOf(m,Undefined$1))v[b]=void 0;else{if(void 0===m)break;v[b]=m}u.splice(0,1)}}if(!f)return n;if("#"===f){var h=getByKeyPath(o,n.substr(1));return void 0===h&&u.push([o,n.substr(1),l,p]),h}var I=a.sync;return[].concat(f).reduce(function(e,t){var n=c[t];if(!n)throw new Error("Unregistered type: "+t);return n[I&&n.revive?"revive":!I&&n.reviveAsync?"reviveAsync":"revive"](e)},n)}}var a=(n=Object.assign({sync:!0},o,n)).sync,s=e&&e.$types,A=!0;if(!s)return e;if(!0===s)return e.$;s.$&&isPlainObject(s.$)&&(e=e.$,s=s.$,A=!1);var u=[],l=_revive("",e,null,n);return l=hasConstructorOf(l,Undefined$1)?void 0:l,isThenable(l)?a&&n.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():l:!a&&n.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():a?l:Promise.resolve(l)};this.reviveSync=function(e,t){return f(e,Object.assign({},{throwOnBadSyncType:!0},t,{sync:!0}))},this.reviveAsync=function(e,t){return f(e,Object.assign({},{throwOnBadSyncType:!0},t,{sync:!1}))},this.register=function(e,t){return t=t||{},[].concat(e).forEach(function R(e){if(i(e))return e.map(R);e&&r(e).forEach(function(n){if("#"===n)throw new TypeError("# cannot be used as a type name as it is reserved for cyclic objects");if(Typeson$1.JSON_TYPES.includes(n))throw new TypeError("Plain JSON object types are reserved as type names");var r=e[n],o=r.testPlainObjects?a:s,u=o.filter(function(e){return e.type===n});if(u.length&&(o.splice(o.indexOf(u[0]),1),delete c[n],delete A[n]),r){if("function"==typeof r){var l=r;r={test:function test(e){return e&&e.constructor===l},replace:function replace(e){return assign({},e)},revive:function revive(e){return assign(Object.create(l.prototype),e)}}}else i(r)&&(r={test:r[0],replace:r[1],revive:r[2]});var p={type:n,test:r.test.bind(r)};r.replace&&(p.replace=r.replace.bind(r)),r.replaceAsync&&(p.replaceAsync=r.replaceAsync.bind(r));var f="number"==typeof t.fallback?t.fallback:t.fallback?0:1/0;if(r.testPlainObjects?a.splice(f,0,p):s.splice(f,0,p),r.revive||r.reviveAsync){var g={};r.revive&&(g.revive=r.revive.bind(r)),r.reviveAsync&&(g.reviveAsync=r.reviveAsync.bind(r)),c[n]=g}A[n]=r}})}),this}}function assign(e,t){return r(t).map(function(n){e[n]=t[n]}),e}function escapeKeyPathComponent(e){return e.replace(/~/g,"~0").replace(/\./g,"~1")}function unescapeKeyPathComponent(e){return e.replace(/~1/g,".").replace(/~0/g,"~")}function getByKeyPath(e,t){if(""===t)return e;var n=t.indexOf(".");if(n>-1){var r=e[unescapeKeyPathComponent(t.substr(0,n))];return void 0===r?void 0:getByKeyPath(r,t.substr(n+1))}return e[unescapeKeyPathComponent(t)]}function Undefined$1(){}function TypesonPromise(e){this.p=new Promise(e)}function xmlHttpRequestOpen(e,t,n){if(/^blob:/.test(t)){var r=ae[t];t="data:"+r.type+";base64,"+r[ce]._buffer.toString("base64")}return Ae.call(this,e,t,n)}function FileList$1(){this._files=arguments[0],this.length=this._files.length}function Person(e,t,n,r){e&&(this.name=e),t&&(this.age=t),n&&(this.dob=n),r&&(this.isMarried=r)}function SimulatedNonBuiltIn(){this.aaa=5}function MyCloneable(e){this.obj=e,this.nonpersistentStateInfo=Math.random()}function ErrorAndErrors(e){describe("Error and Errors",function(){it("should get back real Error instances corresponding to their types and with the original name and message",function(){var t=(new Typeson$1).register(e||[Ie,fe]),n=t.stringify({e1:new Error("Error1"),e2:new TypeError("Error2"),e3:new RangeError("Error3"),e4:new SyntaxError("Error4"),e5:new ReferenceError("Error5")}),r=t.parse(n);expect(r.e1).to.be.an.instanceOf(Error),expect(r.e1.name).to.equal("Error"),expect(r.e2).to.be.an.instanceOf(TypeError),expect(r.e2.name).to.equal("TypeError"),expect(r.e3).to.be.an.instanceOf(RangeError),expect(r.e3.name).to.equal("RangeError"),expect(r.e4).to.be.an.instanceOf(SyntaxError),expect(r.e4.name).to.equal("SyntaxError"),expect(r.e5).to.be.an.instanceOf(ReferenceError),expect(r.e5.name).to.equal("ReferenceError")})})}function SpecialNumbers(e){describe("Special numbers",function(){it("NaN",function(){var t=(new Typeson$1).register(e||ve),n=t.stringify(NaN,null,2),r=t.parse(n);expect(r).to.be.NaN}),it("Infinity",function(){var t=(new Typeson$1).register(e||be),n=t.stringify(1/0,null,2),r=t.parse(n);expect(r).to.equal(1/0)}),it("-Infinity",function(){var t=(new Typeson$1).register(e||me),n=t.stringify(-1/0,null,2),r=t.parse(n);expect(r).to.equal(-1/0)}),it("should not mistake string forms of the special numbers",function(){var t=(new Typeson$1).register(e||[ve,be,me]),n=t.stringify("NaN",null,2),r=t.parse(n);expect(r).to.equal("NaN"),n=t.stringify("Infinity",null,2),r=t.parse(n),expect(r).to.equal("Infinity"),n=t.stringify("-Infinity",null,2),r=t.parse(n),expect(r).to.equal("-Infinity")}),it("should not disturb encoding of normal numbers",function(){var t=(new Typeson$1).register(e||[ve,be,me]),n=t.stringify(512,null,2),r=t.parse(n);expect(r).to.equal(512)})})}function Undefined(e){describe("undefined type",function(){it("should be possible to restore `undefined` properties",function(){var t=(new Typeson$1).register(e||de),n=[void 0,{b:void 0,c:[3,null,,void 0]}],r=t.stringify(n),i=t.parse(r);expect(i.length).to.equal(2),expect(i[0]).to.equal(void 0),expect(i[1].b).to.equal(void 0),expect("b"in i[1]).to.be.true,expect(i[1].c[0]).to.equal(3),expect(i[1].c[1]).to.equal(null),expect(i[1].c[3]).to.equal(void 0),expect("0"in i).to.be.true,expect("b"in i[1]).to.be.true,expect("1"in i[1].c).to.be.true,expect("3"in i[1].c).to.be.true,e?(expect(i[1].c[2]).to.equal(void 0),expect("2"in i[1].c).to.be.false):(expect(i[1].c[2]).to.not.equal(void 0),expect(i[1].c[2]).to.equal(null),expect("2"in i[1].c).to.be.true)}),it("should be possible to restore `undefined` at root",function(){var t=(new Typeson$1).register(e||de),n=t.stringify(void 0);expect(n).to.equal('{"$":null,"$types":{"$":{"":"undef"}}}');var r=t.parse(n);expect(r).to.be.undefined})})}function BuiltIn(e){Undefined(e),describe("Primitive objects",function(){it("String object",function(){var t=(new Typeson$1).register(e||we),n=new String("hello"),r=t.stringify(n,null,2),i=t.parse(r);expect(i).to.be.an.instanceOf(String),expect(i.valueOf()).to.equal("hello"),expect(i.length).to.equal(5)}),it("Boolean object",function(){var t=(new Typeson$1).register(e||we),n=new Boolean(!0),r=t.stringify(n,null,2),i=t.parse(r);expect(i).to.be.an.instanceOf(Boolean),expect(i.valueOf()).to.equal(!0)}),it("Number object",function(){var t=(new Typeson$1).register(e||we),n=new Number(456),r=t.stringify(n,null,2),i=t.parse(r);expect(i).to.be.an.instanceOf(Number),expect(i.valueOf()).to.equal(456)})}),SpecialNumbers(),describe("Date",function(){it("should get back a real Date instance with the original time milliseconds",function(){var t=(new Typeson$1).register(e||he),n=t.stringify(new Date(1234567)),r=t.parse(n);expect(r).to.be.an.instanceOf(Date),expect(r.getTime()).to.equal(1234567)}),it("should get back a real invalid Date instance",function(){var t=(new Typeson$1).register(e||he),n=t.stringify(new Date(NaN)),r=t.parse(n);expect(r).to.be.an.instanceOf(Date),expect(r.getTime()).to.be.NaN})}),ErrorAndErrors(e),describe("RegExp",function(){it("should return a RegExp",function(){var t=(new Typeson$1).register(e||[Ce]),n=new RegExp("ab?c","guy"),r=t.stringify(n,null,2),i=t.parse(r);expect(i instanceof RegExp),expect(i.global).to.equal(!0),expect(i.unicode).to.equal(!0),expect(i.sticky).to.equal(!0),expect(i.ignoreCase).to.equal(!1),expect(i.multiline).to.equal(!1),expect(i.source).to.equal("ab?c"),n=/ab?c/im,r=t.stringify(n,null,2),i=t.parse(r),expect(i instanceof RegExp),expect(i.global).to.equal(!1),expect(i.unicode).to.equal(!1),expect(i.sticky).to.equal(!1),expect(i.ignoreCase).to.equal(!0),expect(i.multiline).to.equal(!0),expect(i.source).to.equal("ab?c")})}),describe("Map",function(){it("should get back a real Map instance with the original data and use complex types also in contained items",function(){var t=(new Typeson$1).register(e||De),n=new Map,r=new Error("Error here"),i=new Date(1e4);n.set(r,i);var o=t.stringify({m:n}),a=t.parse(o);expect(a.m).to.be.an.instanceOf(Map),e&&(expect(Array.from(a.m.keys())[0]).to.be.an.instanceOf(Error),expect(Array.from(a.m.values())[0]).to.be.an.instanceOf(Date))})}),describe("Set",function(){it("should get back a real Set instance with the original data and use complex types also in contained items",function(){var t=(new Typeson$1).register(e||Me),n=new Set,r=new Error("Error here"),i=new Date(1e4),o={a:r};n.add(o),n.add(i),n.add("");var a=t.stringify({s:n}),s=t.parse(a);expect(s.s).to.be.an.instanceOf(Set);var c=Array.from(s.s.values());e&&(expect(c[0].a).to.be.an.instanceOf(Error),expect(c[1]).to.be.an.instanceOf(Date)),expect(c[2]).to.be.a("string")})}),describe("ArrayBuffer",function(){it("should return an ArrayBuffer",function(){var t=(new Typeson$1).register(e||[xe]),n=new ArrayBuffer(16),r=t.stringify(n,null,2),i=t.parse(r);expect(i instanceof ArrayBuffer),expect(i.byteLength).to.equal(16)})}),describe("TypedArrays",function(){describe("Float64Array",function(){it("should get back real Float64Array instance with original array content",function(){var t=(new Typeson$1).register(e||[xe,ge]),n=new Float64Array(3);n[0]=23.8,n[1]=-15,n[2]=99;var r=t.stringify({a:n}),i=t.parse(r);expect(i.a).to.be.an.instanceOf(Float64Array),expect(i.a.length).to.equal(3),expect(i.a[0]).to.equal(23.8),expect(i.a[1]).to.equal(-15),expect(i.a[2]).to.equal(99)})}),describe("Uint16 arrays over invalid unicode range",function(){it("should work to use any 16-bit number no matter whether it is invalid unicode or not",function(){for(var t=(new Typeson$1).register(e||[xe,ge]),n=new Uint16Array(2304),r=n.length;r--;)n[r]=r+55168;var i=t.stringify({a:n});r=i.length;for(var o=new Uint16Array(r);r--;){var a=i.charCodeAt(r);o[r]=a>=55296&&a<57344?65533:a}i=String.fromCharCode.apply(null,o);var s=t.parse(i);expect(s.a).to.be.an.instanceOf(Uint16Array),expect(s.a.length).to.equal(n.length),s.a.forEach(function(e,t){expect(e).to.equal(t+55168)})})}),describe("Int8 arrays with odd length",function(){it("should be possible to use an odd length of an Int8Array",function(){var t=(new Typeson$1).register(e||[xe,ge]),n=new Int8Array(3);n[0]=0,n[1]=1,n[2]=2;var r=t.stringify(n),i=t.parse(r);expect(i.length).to.equal(3),expect(i[0]).to.equal(0),expect(i[1]).to.equal(1),expect(i[2]).to.equal(2)})})}),describe("DataView",function(){it("should return a DataView",function(){var t=(new Typeson$1).register(e||[Be]),n=new Uint8Array([68,51,34,17,255,238,221,204]).buffer,r=new DataView(n,3,4);expect(r.byteLength).to.equal(4);var i=t.stringify(r,null,2),o=t.parse(i);expect(o).to.be.an.instanceOf(DataView),expect(o.byteLength).to.equal(4)})}),describe("Intl types",function(){it("should return a Intl.Collator",function(){var t=(new Typeson$1).register(e||[ye]),n={localeMatcher:"lookup",usage:"search",sensitivity:"base",ignorePunctuation:!0,numeric:!0,caseFirst:"upper"},r=JSON.parse(JSON.stringify(n)),i=new Intl.Collator(["en","hi","de-AT","de-DE-u-co-phonebk","en-US-u-kn-true","en-US-u-kf-upper"],n),o=i.resolvedOptions().locale,a=t.stringify(i,null,2),s=t.parse(a);expect(s instanceof Intl.Collator),expect(s.resolvedOptions().locale).to.deep.equal(o),Object.keys(r).filter(function(e){return!["localeMatcher","locales"].includes(e)}).forEach(function(e){expect(s.resolvedOptions()[e]).to.deep.equal(r[e])})}),it("should return a Intl.DateTimeFormat",function(){var t=(new Typeson$1).register(e||[ye]),n={localeMatcher:"lookup",timeZone:"Asia/Shanghai",hour12:!1,formatMatcher:"basic"},r=JSON.parse(JSON.stringify(n)),i=new Intl.DateTimeFormat(["hi","de-AT","de-DE-u-nu-latn","en-US-u-ca-persian"],n),o=t.stringify(i,null,2),a=t.parse(o);expect(a instanceof Intl.DateTimeFormat),Object.keys(r).filter(function(e){return!["localeMatcher","locales","formatMatcher","hour12"].includes(e)}).forEach(function(e){expect(a.resolvedOptions()[e]).to.deep.equal(r[e])})}),it("should return a Intl.NumberFormat",function(){var t=(new Typeson$1).register(e||[ye]),n={localeMatcher:"lookup",style:"currency",currency:"EUR",currencyDisplay:"symbol",useGrouping:!1},r=JSON.parse(JSON.stringify(n)),i=new Intl.NumberFormat(["hi","de-AT","de-DE-u-nu-bali"],n),o=t.stringify(i,null,2),a=t.parse(o);expect(a instanceof Intl.NumberFormat),Object.keys(r).filter(function(e){return!["localeMatcher","locales"].includes(e)}).forEach(function(e){expect(a.resolvedOptions()[e]).to.deep.equal(r[e])})})})}var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function sliceIterator(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),n=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},r=Object.keys,i=Array.isArray,o={}.toString,a=Object.getPrototypeOf,s={}.hasOwnProperty,c=s.toString;TypesonPromise.prototype.then=function(e,t){var n=this;return new TypesonPromise(function(r,i){n.p.then(function(t){r(e?e(t):t)},function(e){n.p.catch(function(e){return t?t(e):Promise.reject(e)}).then(r,i)})})},TypesonPromise.prototype.catch=function(e){return this.then(null,e)},TypesonPromise.resolve=function(e){return new TypesonPromise(function(t){t(e)})},TypesonPromise.reject=function(e){return new TypesonPromise(function(t,n){n(e)})},["all","race"].map(function(e){TypesonPromise[e]=function(t){return new TypesonPromise(function(n,r){Promise[e](t.map(function(e){return e.p})).then(n,r)})}}),Typeson$1.Undefined=Undefined$1,Typeson$1.Promise=TypesonPromise,Typeson$1.isThenable=isThenable,Typeson$1.toStringTag=toStringTag,Typeson$1.hasConstructorOf=hasConstructorOf,Typeson$1.isObject=isObject,Typeson$1.isPlainObject=isPlainObject,Typeson$1.isUserObject=isUserObject,Typeson$1.escapeKeyPathComponent=escapeKeyPathComponent,Typeson$1.unescapeKeyPathComponent=unescapeKeyPathComponent,Typeson$1.getByKeyPath=getByKeyPath,Typeson$1.getJSONType=function(t){return null===t?"null":i(t)?"array":void 0===t?"undefined":e(t)},Typeson$1.JSON_TYPES=["null","boolean","number","string","array","object"];for(var A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=new Uint8Array(256),l=0;l<A.length;l++)u[A.charCodeAt(l)]=l;var p=function encode(e,t,n){for(var r=new Uint8Array(e,t,n),i=r.length,o="",a=0;a<i;a+=3)o+=A[r[a]>>2],o+=A[(3&r[a])<<4|r[a+1]>>4],o+=A[(15&r[a+1])<<2|r[a+2]>>6],o+=A[63&r[a+2]];return i%3==2?o=o.substring(0,o.length-1)+"=":i%3==1&&(o=o.substring(0,o.length-2)+"=="),o},f=function decode(e){var t=e.length,n=.75*e.length,r=0,i=void 0,o=void 0,a=void 0,s=void 0;"="===e[e.length-1]&&(n--,"="===e[e.length-2]&&n--);for(var c=new ArrayBuffer(n),A=new Uint8Array(c),l=0;l<t;l+=4)i=u[e.charCodeAt(l)],o=u[e.charCodeAt(l+1)],a=u[e.charCodeAt(l+2)],s=u[e.charCodeAt(l+3)],A[r++]=i<<2|o>>4,A[r++]=(15&o)<<4|a>>2,A[r++]=(3&a)<<6|63&s;return c},g={arraybuffer:{test:function test(e){return"ArrayBuffer"===Typeson$1.toStringTag(e)},replace:function replace(e){return p(e)},revive:function revive(e){return f(e)}}},y={blob:{test:function test(e){return"Blob"===Typeson$1.toStringTag(e)},replace:function replace(e){var t=new XMLHttpRequest;if(t.open("GET",URL.createObjectURL(e),!1),200!==t.status&&0!==t.status)throw new Error("Bad Blob access: "+t.status);return t.send(),{type:e.type,stringContents:t.responseText}},revive:function revive(e){var t=e.type,n=e.stringContents;return new Blob([n],{type:t})},replaceAsync:function replaceAsync(e){return new Typeson$1.Promise(function(t,n){if(e.isClosed)n(new Error("The Blob is closed"));else{var r=new FileReader;r.addEventListener("load",function(){t({type:e.type,stringContents:r.result})}),r.addEventListener("error",function(){n(r.error)}),r.readAsText(e)}})}}},d={},w={cloneable:{test:function test(t){return t&&"object"===(void 0===t?"undefined":e(t))&&"function"==typeof t[Symbol.for("cloneEncapsulate")]},replace:function replace(e){var t=e[Symbol.for("cloneEncapsulate")](),n=function generateUUID(){var e=(new Date).getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)})}();return d[n]=e,{uuid:n,encapsulated:t}},revive:function revive(e){var t=e.uuid,n=e.encapsulated;return d[t][Symbol.for("cloneRevive")](n)}}},v={dataview:{test:function test(e){return"DataView"===Typeson$1.toStringTag(e)},replace:function replace(e){var t=e.buffer,n=e.byteOffset,r=e.byteLength;return{buffer:p(t),byteOffset:n,byteLength:r}},revive:function revive(e){var t=e.buffer,n=e.byteOffset,r=e.byteLength;return new DataView(f(t),n,r)}}},b={date:{test:function test(e){return"Date"===Typeson$1.toStringTag(e)},replace:function replace(e){var t=e.getTime();return isNaN(t)?"NaN":t},revive:function revive(e){return"NaN"===e?new Date(NaN):new Date(e)}}},m={error:{test:function test(e){return"Error"===Typeson$1.toStringTag(e)},replace:function replace(e){return{name:e.name,message:e.message}},revive:function revive(e){var t=e.name,n=e.message,r=new Error(n);return r.name=t,r}}},h="undefined"==typeof self?global:self,I={};["TypeError","RangeError","SyntaxError","ReferenceError","EvalError","URIError","InternalError"].forEach(function(e){var t=h[e];t&&(I[e.toLowerCase()]={test:function test(e){return Typeson$1.hasConstructorOf(e,t)},replace:function replace(e){return e.message},revive:function revive(e){return new t(e)}})});var C={file:{test:function test(e){return"File"===Typeson$1.toStringTag(e)},replace:function replace(e){var t=new XMLHttpRequest;if(t.open("GET",URL.createObjectURL(e),!1),200!==t.status&&0!==t.status)throw new Error("Bad Blob access: "+t.status);return t.send(),{type:e.type,stringContents:t.responseText,name:e.name,lastModified:e.lastModified}},revive:function revive(e){var t=e.name,n=e.type,r=e.stringContents,i=e.lastModified;return new File([r],t,{type:n,lastModified:i})},replaceAsync:function replaceAsync(e){return new Typeson$1.Promise(function(t,n){if(e.isClosed)n(new Error("The File is closed"));else{var r=new FileReader;r.addEventListener("load",function(){t({type:e.type,stringContents:r.result,name:e.name,lastModified:e.lastModified})}),r.addEventListener("error",function(){n(r.error)}),r.readAsText(e)}})}}},D={file:C.file,filelist:{test:function test(e){return"FileList"===Typeson$1.toStringTag(e)},replace:function replace(e){for(var t=[],n=0;n<e.length;n++)t[n]=e.item(n);return t},revive:function revive(e){function FileList(){this._files=arguments[0],this.length=this._files.length}return FileList.prototype.item=function(e){return this._files[e]},FileList.prototype[Symbol.toStringTag]="FileList",new FileList(e)}}},M={imagebitmap:{test:function test(e){return"ImageBitmap"===Typeson$1.toStringTag(e)||e&&e.dataset&&"ImageBitmap"===e.dataset.toStringTag},replace:function replace(e){var t=document.createElement("canvas");return t.getContext("2d").drawImage(e,0,0),t.toDataURL()},revive:function revive(e){var t=document.createElement("canvas"),n=t.getContext("2d"),r=document.createElement("img");return r.onload=function(){n.drawImage(r,0,0)},r.src=e,t},reviveAsync:function reviveAsync(e){var t=document.createElement("canvas"),n=t.getContext("2d"),r=document.createElement("img");return r.onload=function(){n.drawImage(r,0,0)},r.src=e,createImageBitmap(t)}}},x={imagedata:{test:function test(e){return"ImageData"===Typeson$1.toStringTag(e)},replace:function replace(e){return{array:Array.from(e.data),width:e.width,height:e.height}},revive:function revive(e){return new ImageData(new Uint8ClampedArray(e.array),e.width,e.height)}}},B={infinity:{test:function test(e){return e===1/0},replace:function replace(e){return"Infinity"},revive:function revive(e){return 1/0}}},E={IntlCollator:{test:function test(e){return Typeson$1.hasConstructorOf(e,Intl.Collator)},replace:function replace(e){return e.resolvedOptions()},revive:function revive(e){return new Intl.Collator(e.locale,e)}},IntlDateTimeFormat:{test:function test(e){return Typeson$1.hasConstructorOf(e,Intl.DateTimeFormat)},replace:function replace(e){return e.resolvedOptions()},revive:function revive(e){return new Intl.DateTimeFormat(e.locale,e)}},IntlNumberFormat:{test:function test(e){return Typeson$1.hasConstructorOf(e,Intl.NumberFormat)},replace:function replace(e){return e.resolvedOptions()},revive:function revive(e){return new Intl.NumberFormat(e.locale,e)}}},O={map:{test:function test(e){return"Map"===Typeson$1.toStringTag(e)},replace:function replace(e){return Array.from(e.entries())},revive:function revive(e){return new Map(e)}}},T={nan:{test:function test(e){return"number"==typeof e&&isNaN(e)},replace:function replace(e){return"NaN"},revive:function revive(e){return NaN}}},S={negativeInfinity:{test:function test(e){return e===-1/0},replace:function replace(e){return"-Infinity"},revive:function revive(e){return-1/0}}},Q={nonbuiltinIgnore:{test:function test(t){return t&&"object"===(void 0===t?"undefined":e(t))&&!Array.isArray(t)&&!["Object","Boolean","Number","String","Error","RegExp","Math","Date","Map","Set","JSON","ArrayBuffer","SharedArrayBuffer","DataView","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","Promise","String Iterator","Array Iterator","Map Iterator","Set Iterator","WeakMap","WeakSet","Atomics","Module"].includes(Typeson$1.toStringTag(t))},replace:function replace(e){}}},q={StringObject:{test:function test(t){return"String"===Typeson$1.toStringTag(t)&&"object"===(void 0===t?"undefined":e(t))},replace:function replace(e){return String(e)},revive:function revive(e){return new String(e)}},BooleanObject:{test:function test(t){return"Boolean"===Typeson$1.toStringTag(t)&&"object"===(void 0===t?"undefined":e(t))},replace:function replace(e){return Boolean(e)},revive:function revive(e){return new Boolean(e)}},NumberObject:{test:function test(t){return"Number"===Typeson$1.toStringTag(t)&&"object"===(void 0===t?"undefined":e(t))},replace:function replace(e){return Number(e)},revive:function revive(e){return new Number(e)}}},U={regexp:{test:function test(e){return"RegExp"===Typeson$1.toStringTag(e)},replace:function replace(e){return{source:e.source,flags:(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.sticky?"y":"")+(e.unicode?"u":"")}},revive:function revive(e){var t=e.source,n=e.flags;return new RegExp(t,n)}}},j={},L={resurrectable:{test:function test(t){return t&&!Array.isArray(t)&&["object","function","symbol"].includes(void 0===t?"undefined":e(t))},replace:function replace(e){var t=function generateUUID$1(){var e=(new Date).getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)})}();return j[t]=e,t},revive:function revive(e){return j[e]}}},$={set:{test:function test(e){return"Set"===Typeson$1.toStringTag(e)},replace:function replace(e){return Array.from(e.values())},revive:function revive(e){return new Set(e)}}},P="undefined"==typeof self?global:self,F={};["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"].forEach(function(e){var t=e,n=P[e];n&&(F[e.toLowerCase()]={test:function test(e){return Typeson$1.toStringTag(e)===t},replace:function replace(e){return(0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e:e.slice(0)).buffer},revive:function revive(e){return"ArrayBuffer"===Typeson$1.toStringTag(e)?new n(e):e}})});var N="undefined"==typeof self?global:self,k={};["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"].forEach(function(e){var t=e,n=N[t];n&&(k[e.toLowerCase()]={test:function test(e){return Typeson$1.toStringTag(e)===t},replace:function replace(e){return p(e.buffer,e.byteOffset,e.byteLength)},revive:function revive(e){return new n(f(e))}})});var V={undef:{test:function test(e,t){return void 0===e&&(t.ownKeys||!("ownKeys"in t))},replace:function replace(e){return null},revive:function revive(e){return new Typeson$1.Undefined}}},J={userObject:{test:function test(e,t){return Typeson$1.isUserObject(e)},replace:function replace(e){return Object.assign({},e)},revive:function revive(e){return e}}},K=[{sparseArrays:{testPlainObjects:!0,test:function test(e){return Array.isArray(e)},replace:function replace(e,t){return t.iterateUnsetNumeric=!0,e}}},{sparseUndefined:{test:function test(e,t){return void 0===e&&!1===t.ownKeys},replace:function replace(e){return null},revive:function revive(e){}}}],Y=[K,V],G=[T,B,S],W=[Y,q,G,b,m,I,U].concat("function"==typeof Map?O:[],"function"==typeof Set?$:[],"function"==typeof ArrayBuffer?g:[],"function"==typeof Uint8Array?k:[],"function"==typeof DataView?v:[],"undefined"!=typeof Intl?E:[]),Z=[m,I],z=[W,{ArrayBuffer:null},F],_=[J,Y,q,G,b,U,x,M,C,D,y].concat("function"==typeof Map?O:[],"function"==typeof Set?$:[],"function"==typeof ArrayBuffer?g:[],"function"==typeof Uint8Array?k:[],"function"==typeof DataView?v:[],"undefined"!=typeof Intl?E:[]),H=_.concat({checkDataCloneException:[function(t){var n={}.toString.call(t).slice(8,-1);if(["symbol","function"].includes(void 0===t?"undefined":e(t))||["Arguments","Module","Error","Promise","WeakMap","WeakSet"].includes(n)||t===Object.prototype||("Blob"===n||"File"===n)&&t.isClosed||t&&"object"===(void 0===t?"undefined":e(t))&&"number"==typeof t.nodeType&&"function"==typeof t.insertBefore)throw new DOMException("The object cannot be cloned.","DataCloneError");return!1}]}),X=[W];Typeson$1.types={arraybuffer:g,blob:y,cloneable:w,dataview:v,date:b,error:m,errors:I,file:C,filelist:D,imagebitmap:M,imagedata:x,infinity:B,intlTypes:E,map:O,nan:T,negativeInfinity:S,nonbuiltinIgnore:Q,primitiveObjects:q,regexp:U,resurrectable:L,set:$,typedArraysSocketio:F,typedArrays:k,undef:V,userObject:J},Typeson$1.presets={builtin:W,postMessage:Z,socketio:z,sparseUndefined:K,specialNumbers:G,structuredCloningThrowing:H,structuredCloning:_,undef:Y,universal:X};var ee="undefined"!=typeof module,te=ee&&require("uuid/v4"),ne=ee&&require("whatwg-url")||{},re=ee&&require("jsdom/lib/jsdom/living/generated/utils")||{},ie=ne.serializeURLOrigin,oe=ne.parseURL,ae={},se=function createObjectURL(e){var t="blob:"+ie(oe(location.href))+"/"+te();return ae[t]=e,t},ce=re.implSymbol,Ae=XMLHttpRequest.prototype.open;URL.createObjectURL||(URL.createObjectURL=se,XMLHttpRequest.prototype.open=xmlHttpRequestOpen),mocha.setup({ui:"bdd",timeout:5e3});var ue="undefined"!=typeof module?global:window;FileList$1.prototype.item=function(e){return this._files[e]},FileList$1.prototype[Symbol.toStringTag]="FileList",Object.defineProperty(ue.HTMLInputElement.prototype,"files",{get:function get(){return new FileList$1(this._files)},set:function set(e){this._files=e}}),ue.FileList=FileList$1,ue.expect=chai.expect,ue.assert=chai.assert,Person.prototype.name="",Person.prototype.age=0,Person.prototype.dob=new Date(1900,0,1),Person.prototype.isMarried=!1,SimulatedNonBuiltIn.prototype.bbb=8,SimulatedNonBuiltIn.prototype[Symbol.toStringTag]="SimulatedNonBuiltIn",MyCloneable.prototype[Symbol.for("cloneEncapsulate")]=function(){return{obj:JSON.stringify(this.obj)}},MyCloneable.prototype[Symbol.for("cloneRevive")]=function(e){return new MyCloneable(JSON.parse(e.obj))},MyCloneable.prototype.prototypeProperty=10;var le={Person:Person,SimulatedNonBuiltIn:SimulatedNonBuiltIn,MyCloneable:MyCloneable,MyResurrectable:function MyResurrectable(){}},pe=Typeson$1.types,fe=pe.errors,ge=pe.typedArrays,ye=pe.intlTypes,de=pe.undef,we=pe.primitiveObjects,ve=pe.nan,be=pe.infinity,me=pe.negativeInfinity,he=pe.date,Ie=pe.error,Ce=pe.regexp,De=pe.map,Me=pe.set,xe=pe.arraybuffer,Be=pe.dataview,Ee=pe.imagedata,Oe=pe.imagebitmap,Te=pe.blob,Se=pe.file,Qe=pe.filelist,qe=pe.nonbuiltinIgnore,Ue=pe.userObject,je=pe.cloneable,Le=pe.resurrectable,$e=Typeson$1.presets,Pe=$e.builtin,Fe=$e.universal,Ne=$e.structuredCloningThrowing,ke=$e.structuredCloning,Ve=$e.specialNumbers,Re=$e.postMessage,Je=$e.undef,Ke=$e.sparseUndefined;describe("Built-in",BuiltIn),describe("ImageData",function(){it("should get back an ImageData instance with the original data",function(){var e=(new Typeson$1).register(Ee),t=new ImageData(1,3),n=e.stringify(t),r=e.parse(n);expect(r.width).to.equal(1),expect(r.height).to.equal(3),expect(r.data).to.deep.equal(new Uint8ClampedArray(12))})}),describe("ImageBitmap",function(){it("should get back an ImageBitmap instance with the original data",function(e){var t=(new Typeson$1).register(Oe),n=document.createElement("canvas"),r=n.getContext("2d"),i=document.createElement("img");i.onload=function(){r.drawImage(i,0,0),createImageBitmap(n).then(function(e){var n=t.stringify(e);return t.parse(n)}).then(function(t){expect(t.width).to.equal(300),expect(t.height).to.equal(150);var n=document.createElement("canvas");n.getContext("2d").drawImage(t,0,0);try{expect(n.toDataURL()).to.equal("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAABmJLR0QA/wD/AP+gvaeTAAACC0lEQVR4nO3UQQ3AIADAwDF7uMMeYpiF/UiTOwV9dcy1zwMQ8N4OAPjLsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwg4wMLwgPj2swUCwAAAABJRU5ErkJggg==")}catch(e){try{expect(n.toDataURL()).to.equal("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAEYklEQVR4Xu3UAQkAAAwCwdm/9HI83BLIOdw5AgQIRAQWySkmAQIEzmB5AgIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlACBB1YxAJfjJb2jAAAAAElFTkSuQmCC")}catch(e){expect(n.toDataURL()).to.equal("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAAxUlEQVR4nO3BMQEAAADCoPVPbQhfoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOA1v9QAATX68/0AAAAASUVORK5CYII=")}}e()})},i.src="undefined"!=typeof imageTestFileNode?imageTestFileNode:"../test/Flag_of_the_United_Nations.png"}),it("should get back an ImageBitmap instance with the original data asynchronously",function(e){var t=(new Typeson$1).register(Oe),n=document.createElement("canvas"),r=n.getContext("2d"),i=document.createElement("img");i.onload=function(){r.drawImage(i,0,0),createImageBitmap(n).then(function(e){var n=t.stringify(e);return t.parseAsync(n)}).then(function(t){expect(t.width).to.equal(300),expect(t.height).to.equal(150);var n=document.createElement("canvas");n.getContext("2d").drawImage(t,0,0);try{expect(n.toDataURL()).to.equal("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAABmJLR0QA/wD/AP+gvaeTAAACC0lEQVR4nO3UQQ3AIADAwDF7uMMeYpiF/UiTOwV9dcy1zwMQ8N4OAPjLsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwg4wMLwgPj2swUCwAAAABJRU5ErkJggg==")}catch(e){try{expect(n.toDataURL()).to.equal("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAEYklEQVR4Xu3UAQkAAAwCwdm/9HI83BLIOdw5AgQIRAQWySkmAQIEzmB5AgIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlACBB1YxAJfjJb2jAAAAAElFTkSuQmCC")}catch(e){expect(n.toDataURL()).to.equal("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAAxUlEQVR4nO3BMQEAAADCoPVPbQhfoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOA1v9QAATX68/0AAAAASUVORK5CYII=")}}e()})},i.src="undefined"!=typeof imageTestFileNode?imageTestFileNode:"../test/Flag_of_the_United_Nations.png"})}),describe("Blob",function(){it("should get back a Blob instance with the original data",function(e){this.timeout(1e4);var t=(new Typeson$1).register(Te),n=JSON.stringify("abcሴ"),r=new Blob([n],{type:"application/json"}),i=t.stringify(r),o=t.parse(i);expect(o.type).to.equal("application/json"),expect("name"in o).to.be.false,expect("lastModified"in o).to.be.false;var a=new FileReader;a.addEventListener("load",function(){expect(a.result).to.equal(n),e()}),a.addEventListener("error",function(){assert(!1,"FileReader should not err")}),a.readAsText(o)}),it("should get back a Blob instance with the original data asynchronously",function(e){var t=(new Typeson$1).register(Te),n=JSON.stringify("abcሴ"),r=new Blob([n],{type:"application/json"});t.stringifyAsync(r).then(function(r){var i=t.parse(r);expect(i.type).to.equal("application/json"),expect("name"in i).to.be.false,expect("lastModified"in i).to.be.false;var o=new FileReader;o.addEventListener("load",function(){expect(o.result).to.equal(n),e()}),o.addEventListener("error",function(){assert(!1,"FileReader should not err")}),o.readAsText(i)})})}),describe("File",function(){this.timeout(1e4),it("should get back a File instance with the original data",function(e){var t=(new Typeson$1).register(Se),n=new Date,r=JSON.stringify("abcሴ"),i=new File([r],"aName",{type:"application/json",lastModified:n}),o=t.stringify(i),a=t.parse(o);expect(a.lastModified).to.equal(n.getTime()),expect(a.type).to.equal("application/json"),expect(a.name).to.equal("aName");var s=new FileReader;s.addEventListener("load",function(){expect(s.result).to.equal(r),e()}),s.addEventListener("error",function(){assert(!1,"FileReader should not err")}),s.readAsText(a)}),it("should get back a File instance with the original data asynchronously",function(e){var t=(new Typeson$1).register(Se),n=new Date,r=JSON.stringify("abcሴ"),i=new File([r],"aName",{type:"application/json",lastModified:n});t.stringifyAsync(i).then(function(i){var o=t.parse(i);expect(o.lastModified).to.equal(n.getTime()),expect(o.type).to.equal("application/json"),expect(o.name).to.equal("aName");var a=new FileReader;a.addEventListener("load",function(){expect(a.result).to.equal(r),e()}),a.addEventListener("error",function(){assert(!1,"FileReader should not err")}),a.readAsText(o)})})}),describe("FileList",function(){this.timeout(1e4),it("should get back a FileList instance with the original data",function(){var e=new Date,t=new Date("1985"),n=document.createElement("input");n.type="file",n.files=[new File(["content1"],"abc",{type:"text/plain",lastModified:e}),new File(["content2"],"def",{type:"text/html",lastModified:t})],expect(n.files).to.be.an.instanceOf(FileList);var r=(new Typeson$1).register(Qe),i=r.stringify(n.files),o=r.parse(i);expect(o.item(0)).to.be.an.instanceOf(File),expect(o.item(0).lastModified).to.equal(e.getTime()),expect(o.item(0).type).to.equal("text/plain"),expect(o.item(0).name).to.equal("abc"),expect(o.item(1)).to.be.an.instanceOf(File),expect(o.item(1).lastModified).to.equal(t.getTime()),expect(o.item(1).type).to.equal("text/html"),expect(o.item(1).name).to.equal("def")}),it("should get back a FileList instance with the original data asynchronously",function(){var e=new Date,t=new Date("1985"),n=document.createElement("input");n.type="file",n.files=[new File(["content1"],"abc",{type:"text/plain",lastModified:e}),new File(["content2"],"def",{type:"text/html",lastModified:t})],expect(n.files).to.be.an.instanceOf(FileList);var r=(new Typeson$1).register(Qe);r.stringifyAsync(n.files).then(function(n){var i=r.parse(n);expect(i.item(0)).to.be.an.instanceOf(File),expect(i.item(0).lastModified).to.equal(e.getTime()),expect(i.item(0).type).to.equal("text/plain"),expect(i.item(0).name).to.equal("abc"),expect(i.item(1)).to.be.an.instanceOf(File),expect(i.item(1).lastModified).to.equal(t.getTime()),expect(i.item(1).type).to.equal("text/html"),expect(i.item(1).name).to.equal("def")})})}),describe("Non-built-in object ignoring",function(){it("should ignore non-built-in objects (simulated)",function(){var e=(new Typeson$1).register(qe),t=new le.Person("John Doe"),n=new le.SimulatedNonBuiltIn,r=e.stringify({a:t,b:n}),i=e.parse(r);expect(i).to.deep.equal({a:{name:"John Doe"}});var o=e.encapsulate(["a",n,5,null]);expect("0"in o).to.be.true,expect("1"in o).to.be.false,expect("2"in o).to.be.true,expect("3"in o).to.be.true})}),describe("User objects",function(){it("should do recursive type checking on user instantiated objects",function(){var e=(new Typeson$1).register([Ue,he]),t=new le.Person("Bob Smith",30,new Date(2e3,5,20),!0),n=new le.SimulatedNonBuiltIn;n.prop=500;var r=e.stringify({a:t,b:n}),i=e.parse(r);expect(i).to.deep.equal({a:{name:"Bob Smith",age:30,dob:new Date(2e3,5,20),isMarried:!0},b:{aaa:5,prop:500}}),expect("dob"in i.a).to.be.true}),it("should work with nonbuiltin-ignore",function(){var e=(new Typeson$1).register([Ue,qe]),t=new le.Person("Bob Smith",30,new Date(2e3,5,20),!0);t.nonbuiltin=new le.SimulatedNonBuiltIn;var n=new le.SimulatedNonBuiltIn,r=e.stringify({a:t,b:n}),i=e.parse(r);expect(i).to.deep.equal({a:{name:"Bob Smith",age:30,isMarried:!0,dob:new Date(2e3,5,20).toJSON()}}),expect("nonbuiltin"in i.a).to.be.false})}),describe("Cloneables",function(){it("Should work with custom cloneable objects",function(){var e=(new Typeson$1).register(je),t={a:1,b:2},n=new le.MyCloneable(t),r=n.nonpersistentStateInfo,i=e.encapsulate(n);expect(n[Symbol.for("cloneEncapsulate")]()).to.deep.equal({obj:JSON.stringify(t)}),expect("nonpersistentStateInfo"in i).to.be.false,expect("prototypeProperty"in i).to.be.false;var o=JSON.stringify(i),a=e.parse(o);expect(a).to.be.an.instanceOf(le.MyCloneable),expect(a).to.not.equal(n),expect(a.obj).to.deep.equal(t),expect(a.hasOwnProperty("nonpersistentStateInfo")).to.be.true,expect(a.nonpersistentStateInfo).to.not.equal(r),expect("prototypeProperty"in a).to.be.true,expect(a.hasOwnProperty("prototypeProperty")).to.be.false})}),describe("Resurrectables",function(){it("Should work with custom resurrectable objects",function(){var e=(new Typeson$1).register(Le),t=new le.MyResurrectable,n=function resurrectableFunction(){},r=Symbol("resurrectable"),i={},o=[3,4,5],a=e.encapsulate([t,n,r,i,o]),s=JSON.stringify(a),c=e.parse(s);expect(c[0]).to.equal(t),expect(c[1]).to.equal(n),expect(c[2]).to.equal(r),expect(c[3]).to.not.equal(i),expect(c[4]).to.not.equal(o)})}),describe("Presets",function(){describe("Built-in (as preset)",function(){BuiltIn([Pe])}),describe("postMessage",function(){ErrorAndErrors([Re])}),describe("Universal",function(){BuiltIn([Fe])}),describe("Structured cloning",function(){it("should work with Structured cloning with throwing",function(){var e=(new Typeson$1).register([Ne]),t=!1;try{e.stringify(new Error("test"))}catch(e){t=!0}assert(t,"Caught error");var n=e.stringify(new Date(123456789e4));expect(n).to.deep.equal('{"$":1234567890000,"$types":{"$":{"":"date"}}}')}),it("should work with Structured cloning without throwing",function(){var e=(new Typeson$1).register([ke]),t=!1;try{e.stringify(new Error("test"))}catch(e){console.log(e),t=!0}assert(!t,"Did not catch error");var n=e.stringify(new Date(123456789e4));expect(n).to.deep.equal('{"$":1234567890000,"$types":{"$":{"":"date"}}}')}),it("should allow recursive type checking on user instantiated objects",function(){var e=(new Typeson$1).register([ke]),t=new le.Person("John Doe"),n=new le.Person("Bob Smith",30,new Date(2e3,5,20),!0),r=e.parse(e.stringify([t,n]));expect(r).to.have.same.deep.members([{name:"John Doe"},{name:"Bob Smith",dob:new Date(2e3,5,20),age:30,isMarried:!0}])})}),describe("Special Numbers (as preset)",function(){SpecialNumbers([Ve])}),describe("Undefined (as preset)",function(){Undefined([Je])}),describe("Sparse undefined",function(){it("should be possible to restore `undefined` properties",function(){var e=(new Typeson$1).register([Ke]),t=[void 0,{b:void 0,c:[3,null,,void 0]}],n=e.stringify(t),r=e.parse(n);expect(r.length).to.equal(2),expect(r[0]).to.equal(null),expect("b"in r[1]).to.be.false,expect(r[1].c[0]).to.equal(3),expect(r[1].c[1]).to.equal(null),expect(r[1].c[2]).to.equal(void 0),expect("2"in r[1].c).to.be.false,expect(r[1].c[3]).to.equal(null)})})}),mocha.run()});
//# sourceMappingURL=test-polyglot.js.map
