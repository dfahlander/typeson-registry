{"version":3,"file":"createObjectURL-polyglot.js","sources":["createObjectURL.js"],"sourcesContent":["/* eslint-env node */\n// Imperfectly polyfill jsdom for testing `Blob`/`File`\n// Todo: This can be removed once `URL.createObjectURL` may\n//    be implemented in jsdom: https://github.com/tmpvar/jsdom/issues/1721\n\n// These are not working well with Rollup as imports\nconst mod = typeof module !== 'undefined';\nconst uuid = mod && require('uuid/v4');\nconst whatwgURL = (mod && require('whatwg-url')) || {};\n// We also need to tweak `XMLHttpRequest` which our types\n//    rely on to obtain the Blob/File content\nconst utils = (mod && require('jsdom/lib/jsdom/living/generated/utils')) || {};\n\nconst {serializeURLOrigin, parseURL} = whatwgURL;\n\nconst blobURLs = {};\nconst createObjectURL = function (blob) {\n    // https://github.com/tmpvar/jsdom/issues/1721#issuecomment-282465529\n    const blobURL = 'blob:' + serializeURLOrigin(parseURL(location.href)) + '/' + uuid();\n    blobURLs[blobURL] = blob;\n    return blobURL;\n};\n\nconst impl = utils.implSymbol;\nconst _xhropen = XMLHttpRequest.prototype.open;\n\n// Add to XMLHttpRequest.prototype.open\nfunction xmlHttpRequestOpen (method, url, async) {\n    if ((/^blob:/).test(url)) {\n        const blob = blobURLs[url];\n        const type = blob.type;\n        url = 'data:' + type + ';base64,' + blob[impl]._buffer.toString('base64');\n    }\n    return _xhropen.call(this, method, url, async);\n};\n\nexport {createObjectURL, xmlHttpRequestOpen};\n"],"names":["mod","module","uuid","require","whatwgURL","utils","serializeURLOrigin","parseURL","blobURLs","impl","implSymbol","_xhropen","XMLHttpRequest","prototype","open","createObjectURL","blob","blobURL","location","href","xmlHttpRequestOpen","method","url","async","test","type","_buffer","toString","call","this"],"mappings":"kMAMA,IAAMA,EAAwB,oBAAXC,OACbC,EAAOF,GAAOG,QAAQ,WACtBC,EAAaJ,GAAOG,QAAQ,kBAG5BE,EAASL,GAAOG,QAAQ,8CAEvBG,EAAgCF,EAAhCE,mBAAoBC,EAAYH,EAAZG,SAErBC,KAQAC,EAAOJ,EAAMK,WACbC,EAAWC,eAAeC,UAAUC,uBARlB,SAAlBC,gBAA4BC,OAExBC,EAAU,QAAUX,EAAmBC,EAASW,SAASC,OAAS,IAAMjB,aACrEe,GAAWD,EACbC,wBAOX,SAASG,mBAAoBC,EAAQC,EAAKC,MACjC,SAAUC,KAAKF,GAAM,KAChBN,EAAOR,EAASc,KAEhB,QADON,EAAKS,KACK,WAAaT,EAAKP,GAAMiB,QAAQC,SAAS,iBAE7DhB,EAASiB,KAAKC,KAAMR,EAAQC,EAAKC"}